version: '3.7'
services:
    py-back:
        hostname: ${COMPOSE_PROJECT_NAME}-py-back
        build:
            context: py-back
            args:
                DOCKER_UID: ${DOCKER_UID}
        volumes:
            - ../..:/var/www/html
        environment:
            FLASK_ENV: development
            DB_HOST: postgres
            DB_PASS: ${DB_PASS}
            DB_USER: ${DB_USER}
            DB_NAME: ${DB_NAME}
            DB_PORT: 5432
            ADMIN_PWD: ${ADMIN_PWD}
            SECRET_KEY: ${SECRET_KEY}
            JWT_SECRET_KEY: ${JWT_SECRET_KEY}
        depends_on:
            - postgres
        command: >
            sh -c "make .refresh_pipenv && python manager.py start"
        ports:
            - ${LOCAL_WEB_PORT}:5001
 
    postgres:
        image: postgres:13.1
        hostname: ${COMPOSE_PROJECT_NAME}-postgres
        restart: unless-stopped
        volumes:
            - postgres:/var/lib/postgresql/data/
        environment:
          POSTGRES_USER: ${DB_USER}
          POSTGRES_DB: ${DB_NAME}
          POSTGRES_PASSWORD: ${DB_PASS}
        ports:
            - ${LOCAL_DB_PORT}:5432

    adminer:
        image: adminer:4.7
        hostname: ${COMPOSE_PROJECT_NAME}-adminer
        environment:
            ADMINER_DEFAULT_SERVER: postgres
        depends_on:
            - postgres
        ports:
            - ${LOCAL_ADMINER_PORT}:8080

volumes:
    postgres:
