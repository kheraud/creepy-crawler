version: '3.7'
services:
    py-api:
        hostname: ${COMPOSE_PROJECT_NAME}-py-api
        build:
            context: ../../api
            args:
                DOCKER_UID: ${DOCKER_UID}
        volumes:
            - ../../api:/var/www/html
            - ../../databases:/opt/db
        environment:
            APP_ENV: development
            DB_PATH: /opt/db/app.db
            GITHUB_USER: ${GITHUB_USER}
            GITHUB_PASSWORD: ${GITHUB_PASSWORD}
            LOG_LEVEL: ${LOG_LEVEL}
        command: >
            sh -c "pipenv install --system && python ./serve.py"
        ports:
            - ${LOCAL_API_PORT}:5000

    js-front:
        hostname: ${COMPOSE_PROJECT_NAME}-js-front
        build:
            context: ../../front
            args:
                DOCKER_UID: ${DOCKER_UID}
        volumes:
            - ../../front:/var/www/html
            - ../../api/dist:/var/www/dist
        environment:
            NODE_ENV: development
            PROXY_API: http://py-api:5000
            DIST_DIR: /var/www/dist
        command: >
            sh -c "npm install && npm run serve"
        ports:
            - ${LOCAL_FRONT_PORT}:8080

    sqlite-web:
        image: coleifer/sqlite-web:latest
        hostname: ${COMPOSE_PROJECT_NAME}-sqlite-web
        environment:
            SQLITE_DATABASE: app.db
        volumes:
            - ../../databases:/data
        depends_on:
            - py-api
        ports:
            - ${LOCAL_DB_PORT}:8080

volumes:
    static-dist: